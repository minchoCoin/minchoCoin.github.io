---
title: "μC/OS-III ch.4 Critical Sections"
last_modified_at: 2023-09-21T11:53:12+09:00
categories:
    - microc-os-stm32
tags:
    - microc-os
    - embedded-system

toc: true
toc_label: "My Table of Contents"
author_profile: true

---
critical region이라고 불리는 코드의 임계 영역은 나눠서 실행할 수 없는 코드이다. μC/OS-III에는 많은 임계 영역이 있다. ISR과 task가 한 임계영역에 접근할 수 있다면, 인터럽트를 비활성화하는 것이 필요하다. 만약 task level 코드만 임계영역에 접근할 수 있으면, preemption lock사용을 통해 임계 구역을 보호할 수 있다.

μC/OS-III에서, 임계구역 접근 방법은 인터럽트가 어떤 ISR post 방법을 사용하느냐에 따라 달라진다. 만약 OS_CFG_ISR_POST_DEFERRED_EN이 0이면(os_cfg.h 참조) 내부 임계구역에 접근할 때 인터럽트를 비활성화한다. 만약 OS_CFG_ISR_POST_DEFERRED_EN이 1이면 내부 임계구역에 접근할 때 스케쥴러를 잠근다.

μC/OS-III에는 임계구역에 들어가는 함수 하나와 나오는 함수 2개가 있다.
```
OS_CRITICAL_ENTER()
OS_CRITICAL_EXIT()
OS_CRITICAL_EXIT_NO_SCHED()
```
이 함수는 μC/OS-III 내부 함수이고, application code가 호출하면 안된다.

# 4-1 Disabling interrupts

OS_CFG_ISR_POST_DEFERRED_EN이 0이면, μC/OS-III는 임계구역에 들어가기 전에 인터럽트를 비활성화하고, 임계구역에서 나올 때 인터럽트를 다시 활성화한다.

(to be continued...)

(to be continued)
# Reference
 - uC/OS-III: The Real-Time Kernel For the STM32 ARM Cortex-M3, Jean J. Labrosse, Micrium, 2009

[책 링크](https://micrium.atlassian.net/wiki/spaces/osiiidoc/overview)
